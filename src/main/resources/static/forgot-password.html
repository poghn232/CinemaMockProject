<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quên mật khẩu | MovieZone</title>

    <style>
        body {
            font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background:
                    radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.08), transparent 50%),
                    radial-gradient(circle at 100% 100%, rgba(255, 255, 255, 0.05), transparent 55%),
                    linear-gradient(135deg, #050816, #0b1220 50%, #020617);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            color: #e5e7eb;
            overflow: hidden;
        }

        .backdrop-blur {
            position: fixed;
            inset: 0;
            background:
                    linear-gradient(to right, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7)),
                    url("https://images.pexels.com/photos/7991377/pexels-photo-7991377.jpeg?auto=compress&cs=tinysrgb&w=1600")
                    center/cover no-repeat;
            filter: brightness(0.9);
            z-index: -1;
        }

        .forgot-wrapper {
            display: grid;
            grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
            gap: 60px;
            width: min(1000px, 100% - 64px);
            align-items: center;
        }

        @media (max-width: 820px) {
            .forgot-wrapper {
                grid-template-columns: 1fr;
                gap: 32px;
            }
        }

        .brand-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .brand-logo {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-size: 14px;
            color: #e5e7eb;
        }

        .brand-logo span {
            width: 26px;
            height: 26px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 20%, #f97316, #e11d48 55%, #4f46e5);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 25px rgba(248, 113, 113, 0.45);
            font-size: 14px;
        }

        .brand-title {
            font-size: clamp(28px, 3.1vw, 34px);
            font-weight: 700;
            line-height: 1.15;
        }

        .brand-title span {
            color: #f97316;
        }

        .brand-subtitle {
            max-width: 430px;
            font-size: 14px;
            color: #9ca3af;
        }

        .tagline-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 4px;
        }

        .tagline-chip {
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.45);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: #e5e7eb;
            backdrop-filter: blur(12px);
            background-color: rgba(15, 23, 42, 0.75);
        }

        .poster-row {
            display: flex;
            gap: 10px;
            margin-top: 18px;
        }

        .poster {
            flex: 1;
            aspect-ratio: 2 / 3;
            border-radius: 14px;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 35px rgba(0, 0, 0, 0.6);
        }

        .poster::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.96), transparent 55%);
        }

        .poster-info {
            position: absolute;
            inset-inline: 10px;
            bottom: 10px;
            z-index: 1;
        }

        .poster-title {
            font-size: 13px;
            font-weight: 600;
        }

        .poster-tag {
            margin-top: 4px;
            font-size: 11px;
            color: #d1d5db;
        }

        .poster-1 {
            background-image: url("https://image.tmdb.org/t/p/w500/9TEJXta9Jjd26jKV4wLGYzFPYfC.jpg");
        }

        .poster-2 {
            background-image: url("https://image.tmdb.org/t/p/w500/bcERImYVxN8pPMP4RPgCvm91vB.jpg");
        }

        .poster-3 {
            background-image: url("https://image.tmdb.org/t/p/w500/ixZdcct8F7zfMDfUYFhXTR2iCpL.jpg");
        }

        .forgot-container {
            background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.28), transparent 55%),
            radial-gradient(circle at 100% 100%, rgba(249, 115, 22, 0.25), transparent 55%),
            rgba(15, 23, 42, 0.96);
            padding: 30px 28px 26px;
            width: 340px;
            border-radius: 18px;
            box-shadow:
                    0 0 0 1px rgba(148, 163, 184, 0.35),
                    0 18px 45px rgba(15, 23, 42, 0.95);
            text-align: left;
            backdrop-filter: blur(22px);
        }

        .forgot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .forgot-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .forgot-caption {
            margin: 0;
            margin-top: 4px;
            font-size: 13px;
            color: #9ca3af;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 11px;
            background: rgba(249, 115, 22, 0.12);
            border: 1px solid rgba(249, 115, 22, 0.55);
            color: #fed7aa;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: #fb923c;
            box-shadow: 0 0 0 4px rgba(251, 146, 60, 0.35);
        }

        form {
            margin-top: 8px;
        }

        .field {
            margin-bottom: 12px;
        }

        .field-label {
            font-size: 12px;
            margin-bottom: 5px;
            color: #d1d5db;
        }

        input {
            width: 100%;
            padding: 9px 11px;
            margin: 0;
            box-sizing: border-box;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            background-color: rgba(15, 23, 42, 0.9);
            color: #e5e7eb;
            font-size: 13px;
            outline: none;
            transition: border-color 0.18s ease, box-shadow 0.18s ease, background-color 0.18s ease;
        }

        input::placeholder {
            color: #6b7280;
        }

        input:focus {
            border-color: #f97316;
            box-shadow: 0 0 0 1px rgba(249, 115, 22, 0.65), 0 0 0 10px rgba(249, 115, 22, 0.1);
            background-color: rgba(15, 23, 42, 1);
        }

        button {
            width: 100%;
            padding: 11px;
            margin-top: 6px;
            background: linear-gradient(135deg, #f97316, #ec4899);
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            border-radius: 999px;
            font-weight: 600;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            box-shadow:
                    0 12px 25px rgba(248, 113, 113, 0.5),
                    0 0 0 1px rgba(248, 113, 113, 0.45);
            transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
        }

        button:hover {
            filter: brightness(1.05);
            transform: translateY(-1px);
            box-shadow:
                    0 16px 30px rgba(248, 113, 113, 0.7),
                    0 0 0 1px rgba(248, 113, 113, 0.75);
        }

        button:active {
            transform: translateY(0);
            box-shadow:
                    0 8px 18px rgba(248, 113, 113, 0.5),
                    0 0 0 1px rgba(248, 113, 113, 0.75);
        }

        .helper-row {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: #9ca3af;
        }

        .helper-row a {
            color: #f97316;
            text-decoration: none;
            font-weight: 500;
        }

        .helper-row a:hover {
            text-decoration: underline;
        }

        #msg {
            margin-top: 12px;
            font-size: 12px;
            min-height: 16px;
            color: #fbbf24;
        }
    </style>
</head>
<body>

<div class="backdrop-blur"></div>

<div class="forgot-wrapper">
    <section class="brand-section">
        <div class="brand-logo">
            <span>MZ</span>
            <span>MovieZone</span>
        </div>
        <h1 class="brand-title">
            Quên mật khẩu?<br/>
            <span>Đừng lo</span>, mình gửi lại ngay.
        </h1>
        <p class="brand-subtitle">
            Nhập đúng username của bạn. Hệ thống sẽ tạo một mật khẩu mới và gửi về email đã đăng ký.
        </p>

        <div class="tagline-chips">
            <div class="tagline-chip">Nhanh chóng</div>
            <div class="tagline-chip">Bảo mật</div>
            <div class="tagline-chip">Gửi qua email</div>
        </div>

        <div class="poster-row">
            <article class="poster poster-1">
                <div class="poster-info">
                    <div class="poster-title">Night City Stories</div>
                    <div class="poster-tag">Hành động · 2025</div>
                </div>
            </article>
            <article class="poster poster-2">
                <div class="poster-info">
                    <div class="poster-title">Echoes of Stars</div>
                    <div class="poster-tag">Khoa học viễn tưởng</div>
                </div>
            </article>
            <article class="poster poster-3">
                <div class="poster-info">
                    <div class="poster-title">Hidden Notes</div>
                    <div class="poster-tag">Tâm lý · Âm nhạc</div>
                </div>
            </article>
        </div>
    </section>

    <section class="forgot-container">
        <div class="forgot-header">
            <div>
                <h2>Quên mật khẩu</h2>
                <p class="forgot-caption">Nhập username để nhận mật khẩu mới.</p>
            </div>
            <div class="badge">
                <span class="badge-dot"></span>
                Reset nhanh
            </div>
        </div>

        <form id="forgotForm">

            <!-- STEP 1 -->
            <div id="step1">
                <div class="field">
                    <div class="field-label">Tên đăng nhập</div>
                    <input type="text" id="username" placeholder="Nhập username của bạn" required>
                </div>
                <button type="button" onclick="sendOtp()">Gửi OTP</button>
            </div>

            <!-- STEP 2 -->
            <div id="step2" style="display:none;">
                <div class="field">
                    <div class="field-label">Nhập OTP</div>
                    <input type="text" id="otp" placeholder="Nhập mã OTP" required>
                </div>
                <button type="button" onclick="verifyOtp()">Xác minh OTP</button>
            </div>

            <!-- STEP 3 -->
            <div id="step3" style="display:none;">
                <div class="field">
                    <div class="field-label">Mật khẩu mới</div>
                    <input type="password" id="newPassword" placeholder="Nhập mật khẩu mới" required>
                </div>
                <button type="button" onclick="resetPassword()">Đổi mật khẩu</button>
            </div>

            <p id="msg"></p>

            <div class="helper-row">
                <span>Quay lại <a href="login.html">Đăng nhập</a></span>
                <a href="register.html">Tạo tài khoản</a>
            </div>
        </form>
    </section>
</div>
<script>
    const msgEl = document.getElementById("msg");

    function showMessage(text, color) {
        msgEl.style.color = color;
        msgEl.innerText = text;
    }

    async function sendOtp() {
        const username = document.getElementById("username").value;

        showMessage("Đang gửi OTP...", "#fbbf24");

        try {
            const res = await fetch("/api/auth/forgot-password/send-otp", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ username })
            });

            const data = await res.json();

            if (res.ok) {
                showMessage(data.message, "#22c55e");
                document.getElementById("step1").style.display = "none";
                document.getElementById("step2").style.display = "block";
            } else {
                showMessage(data.message || "Lỗi gửi OTP", "#ef4444");
            }
        } catch (err) {
            showMessage("Không thể kết nối server", "#ef4444");
        }
    }

    async function verifyOtp() {
        const username = document.getElementById("username").value;
        const otp = document.getElementById("otp").value;

        showMessage("Đang xác minh OTP...", "#fbbf24");

        try {
            const res = await fetch("/api/auth/forgot-password/verify", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ username, otp })
            });

            const data = await res.json();

            if (res.ok) {
                showMessage(data.message, "#22c55e");
                document.getElementById("step2").style.display = "none";
                document.getElementById("step3").style.display = "block";
            } else {
                showMessage(data.message || "OTP không hợp lệ", "#ef4444");
            }
        } catch (err) {
            showMessage("Không thể kết nối server", "#ef4444");
        }
    }

    async function resetPassword() {
        const username = document.getElementById("username").value;
        const newPassword = document.getElementById("newPassword").value;

        showMessage("Đang đổi mật khẩu...", "#fbbf24");

        try {
            const res = await fetch("/api/auth/forgot-password/reset", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ username, newPassword })
            });

            const data = await res.json();

            if (res.ok) {
                showMessage(data.message, "#22c55e");

                setTimeout(() => {
                    window.location.href = "login.html";
                }, 2000);
            } else {
                showMessage(data.message || "Không thể đổi mật khẩu", "#ef4444");
            }
        } catch (err) {
            showMessage("Không thể kết nối server", "#ef4444");
        }
    }
</script>
</body>
</html>

